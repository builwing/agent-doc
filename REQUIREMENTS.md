了解です。いただいた要件定義の構成に合わせて、\*\*「数当てゲーム」\*\*版の要件定義書を作成しました。必要に応じて、プロジェクト名や機能の粒度は後から調整できます。

---

# プロジェクト要件定義書（数当てゲーム）

## 1. プロジェクト概要

### 基本情報

| 項目            | 内容                 |
| ------------- | ------------------ |
| **プロジェクト名**   | GuessNumber        |
| **バージョン**     | 1.0.0              |
| **プロジェクトタイプ** | Webゲーム（ブラウザ／PWA対応） |
| **作成日**       | 2025-08-26         |
| **ステータス**     | Active             |

### プロジェクト説明

GuessNumber は、1〜N の乱数をプレイヤーが推測する**シンプルな数当てゲーム**です。難易度・ヒント・タイマー・スコアリング・リーダーボード（任意）を備え、短時間で遊べる軽量ゲーム体験を提供します。PC/モバイルの両方で快適にプレイできます。

## 2. ビジネス要件

### 2.1 目的

* 学習用・デモ用に**短期間でリリース**できるゲームの提供
* HTML/CSS/JS（あるいは Next.js）での**軽量なゲーム実装例**の提示
* PWA 化により**オフラインでも遊べる**体験の提供
* 基本的な計測（プレイ回数・平均クリア時間）で**継続改善の材料**を得る

### 2.2 対象ユーザー

* 初学者（JS/React 学習者）
* ちょっとした空き時間に遊ぶカジュアルユーザー
* 研修・ワークショップ参加者

### 2.3 主要機能

* [ ] ゲーム開始／再開／リセット
* [ ] 難易度選択（Easy/Normal/Hard、上限値・ヒント頻度・制限時間が変化）
* [ ] 推測入力・判定（大きい／小さい／正解）
* [ ] タイマー・残り試行回数
* [ ] スコアリング（時間・試行回数ベース）
* [ ] ローカル保存（最高記録・設定）
* [ ] リーダーボード（任意：サーバなし版は端末ローカル）
* [ ] PWA（インストール・オフライン起動）

## 3. システム要件

### 3.1 機能要件の詳細

* **ゲームロジック**

  * 乱数を 1〜N で生成（難易度により N を変更：Easy=30, Normal=50, Hard=100 など）
  * 入力値に対して「大きい／小さい／正解」を即時表示
  * 試行上限＆制限時間（難易度別）を管理
* **UI/UX**

  * モバイル優先のレスポンシブ設計
  * キーボード入力とボタン操作の両対応
  * 視認性の高いフィードバック（色・トースト）
* **ヒント機能**

  * 範囲縮小ヒント（例：現在の範囲 12〜67）
  * 回数制限付きヒント（難易度別）
* **スコア・記録**

  * クリアタイム、試行回数、難易度を記録
  * 最高記録（LocalStorage）／直近履歴の参照
* **設定**

  * 難易度既定値、サウンド ON/OFF、色覚多様性モード
* **PWA**

  * オフラインキャッシュ、ホーム画面追加、スプラッシュ
* **計測（任意）**

  * 端末ローカルでプレイ回数・平均クリア時間を集計

### 3.2 ユーザーストーリー詳細化

#### 新規ユーザー向けストーリー
* **初回プレイヤーとして**, スプラッシュ画面からチュートリアルまでを30秒以内で理解し、最初のゲームを開始したい
* **初回プレイヤーとして**, 推測の仕組みと「大きい/小さい」のフィードバックを3回の試行で理解したい  
* **初回プレイヤーとして**, ヒント機能の存在と使い方を自然に発見したい
* **初回プレイヤーとして**, 失敗してもすぐに再挑戦できる仕組みを期待する
* **初回プレイヤーとして**, スコア表示の意味を直感的に理解したい

#### 継続ユーザー向けストーリー
* **継続プレイヤーとして**, 前回の設定（難易度、音設定等）を記憶しており、すぐに好みのゲームを開始したい
* **継続プレイヤーとして**, 自己ベストの更新を目指し、過去の記録と比較したい
* **継続プレイヤーとして**, より高い難易度への段階的な挑戦を楽しみたい
* **継続プレイヤーとして**, 短時間の隙間時間（1-2分）で満足のいくゲーム体験をしたい
* **継続プレイヤーとして**, 日々のプレイ統計や傾向を確認したい

#### アクセシビリティユーザー向けストーリー
* **視覚障害のあるプレイヤーとして**, スクリーンリーダーでゲーム状況とフィードバックを正確に把握したい
* **聴覚障害のあるプレイヤーとして**, 音に依存しない視覚的フィードバックでゲームを楽しみたい
* **運動制限のあるプレイヤーとして**, キーボードのみでの操作を完結したい
* **色覚多様性のあるプレイヤーとして**, 色以外の区別方法（形状、パターン）でフィードバックを理解したい

#### モバイルユーザー向けストーリー
* **スマートフォンユーザーとして**, 片手操作で快適にゲームをプレイしたい
* **タブレットユーザーとして**, 横画面でも縦画面でも最適化されたレイアウトを期待する
* **PWAユーザーとして**, オフラインでも中断なくゲームを継続したい
* **モバイルユーザーとして**, バッテリー消費を抑えた軽量な動作を期待する

#### 学習・教育利用ユーザー向けストーリー
* **プログラミング学習者として**, TypeScriptとReactのベストプラクティスを実例から学びたい
* **講師として**, 授業や研修で即座にデモンストレーションできる環境構築不要のツールとして活用したい
* **学生として**, ソースコードを参考に独自のゲーム拡張を実装したい
* **企業研修担当者として**, チーム開発の練習題材として使いたい

### 3.3 エッジケースと例外シナリオ

#### ユーザー入力関連のエッジケース
```typescript
interface InputEdgeCases {
  // 数値以外の入力
  nonNumericInputs: [
    '文字列入力（abc、漢字、ひらがな）',
    '特殊文字（@#$%、絵文字）', 
    '空文字・スペースのみ',
    'null/undefined相当の入力'
  ],
  
  // 数値だが無効な入力
  invalidNumbers: [
    '範囲外の数値（-1、0、上限+1、999999）',
    '小数点数（3.14、1.5）',
    '科学的記法（1e10、2E-3）',
    '先頭ゼロ付き数値（007、0123）'
  ],
  
  // 境界値テスト
  boundaryValues: [
    '最小値（1）',
    '最大値（難易度別上限）',
    '最小値-1、最大値+1',
    '非常に大きな数値（JavaScript MAX_SAFE_INTEGER）'
  ],
  
  // 重複・履歴関連
  duplicateInputs: [
    '同じ数値の連続入力',
    '過去に入力済みの数値',
    '入力履歴の順序確認'
  ]
}
```

#### システム状態関連のエッジケース
```typescript
interface SystemEdgeCases {
  // ゲーム状態異常
  gameStateCorruption: [
    'localStorage データ破損時の復旧',
    '不整合なゲーム状態（remainingAttempts < 0）',
    '不正な難易度設定',
    '異常なスコア値（負数、NaN、Infinity）'
  ],
  
  // タイマー関連
  timerEdgeCases: [
    '0秒でのタイムアウト処理',
    'ページ非アクティブ時のタイマー継続',
    'ブラウザ復帰時の時間同期',
    'システム時刻変更の影響'
  ],
  
  // ストレージ関連
  storageEdgeCases: [
    'localStorage 使用量上限達成',
    'プライベートブラウジングモード',
    'ストレージアクセス権限なし',
    'ストレージデータ形式の非互換'
  ],
  
  // ネットワーク関連（将来のAPI用）
  networkEdgeCases: [
    'オフライン状態でのゲーム継続',
    'ネットワーク復旧時の同期処理',
    'API レスポンス遅延（>5秒）',
    '部分的ネットワーク障害'
  ]
}
```

#### UIと操作性のエッジケース
```typescript
interface UiEdgeCases {
  // デバイス・ブラウザ固有
  deviceSpecificIssues: [
    '極端に小さい画面（320px幅）',
    '極端に大きい画面（4K、ウルトラワイド）',
    '古いブラウザでの機能制限',
    '高DPIディスプレイでの表示'
  ],
  
  // ユーザー操作の異常パターン
  unusualInteractions: [
    '非常に高速な連続入力（spam防止）',
    '長時間の無操作状態',
    'ページリロード直後の操作',
    '複数タブでの同時プレイ'
  ],
  
  // アニメーション・パフォーマンス
  performanceEdgeCases: [
    'low-spec デバイスでのアニメーション',
    'reduced-motion設定時の対応',
    'メモリ不足時の処理',
    'バックグラウンドタブでの挙動'
  ]
}
```

#### データ整合性のエッジケース
```typescript
interface DataIntegrityEdgeCases {
  // スコア・統計データ
  scoreDataIssues: [
    'スコア計算でのオーバーフロー',
    '統計データの累積エラー', 
    'ベストレコードの競合状態',
    '日付跨ぎ時の統計リセット'
  ],
  
  // 設定データ
  settingsDataIssues: [
    '未知の設定キーの処理',
    '設定値の型不整合',
    'バージョン間の設定互換性',
    'デフォルト設定への復帰'
  ],
  
  // 多言語・ローカライゼーション
  localizationEdgeCases: [
    'ブラウザ言語設定の変更',
    '未対応言語での表示',
    'RTL言語での UI レイアウト',
    '文字エンコーディングの問題'
  ]
}

### 3.3 ユースケース

1. **新規ゲーム開始**

   * 難易度選択 → 乱数生成 → タイマー開始 → 入力→判定→勝敗→記録更新
2. **機能追加**

   * 新ヒント（偶奇、桁ヒント）、自動レベルアップ（連勝で上限値UP）
3. **品質保証**

   * コアロジック（乱数範囲、判定、スコア計算）の単体テスト
   * UI コンポーネントのスナップショットテスト（任意）

## 4. 制約事項

### 4.1 ビジネス制約

* MVP を\*\*最短（1〜2日）\*\*で完成可能なスコープに留める
* 予算ゼロ（**オープンソース**前提）
* サーバレス（**バックエンド不要**）を基本とする

### 4.2 運用制約

* 24/7 の可用性は保証しない（静的ホスティング想定）
* サポートはベストエフォート
* ドキュメントは日本語／英語の併記を目標

## 5. 成功基準

### 5.1 ビジネス成功指標

* [ ] MVP リリースまで 2 日以内
* [ ] 初回訪問から 10 秒以内にプレイ開始できる
* [ ] 直帰率 40% 未満（ゲーム開始操作で計測）
* [ ] 平均プレイ時間 2 分以上

### 5.2 プロジェクト完了基準

* [ ] 主要機能（開始・判定・スコア・難易度・PWA）実装
* [ ] ユーザーマニュアル（README）完成
* [ ] 学習者向けチュートリアル（セットアップ・拡張例）
* [ ] デモ環境（静的ホスティング）公開

## 6. リスク管理

### 6.1 ビジネスリスク

| リスク         | 影響度    | 発生確率   | 対策                  |
| ----------- | ------ | ------ | ------------------- |
| 継続率が低い      | Medium | Medium | ヒント・ランダム要素・短セッション設計 |
| 競合（似たゲーム多数） | Low    | High   | PWA・学習用コード品質で差別化    |
| デバイス多様性     | Low    | Medium | レスポンシブ・軽量化・入力方法の両立  |

### 6.2 プロジェクトリスク

| リスク        | 影響度    | 発生確率   | 対策                       |
| ---------- | ------ | ------ | ------------------------ |
| スコープ肥大     | Medium | Medium | MVP 優先、機能フラグで後付け         |
| パフォーマンス劣化  | Low    | Low    | 依存最小、静的配信、画像なし設計         |
| アクセシビリティ不足 | Medium | Medium | キーボード操作・コントラスト確保・SR 対応基礎 |

## 7. ステークホルダー

### 7.1 主要ステークホルダー

| 役割        | 責任          | 期待事項          |
| --------- | ----------- | ------------- |
| プロダクトオーナー | スコープ定義・優先順位 | 速い MVP リリース   |
| 開発者       | 実装・テスト・PWA化 | シンプルで読みやすいコード |
| 学習者／講師    | 利用・改善提案     | 学習教材としての有用性   |
| 運用担当      | ビルド・配信      | 安定配信・軽量更新     |

### 7.2 コミュニケーション計画

* **定期レビュー**: 2日に1回（MVP期間）
* **進捗報告**: 日次（Issue/PRで可視化）
* **リリース通知**: 各タグ作成時
* **フィードバック収集**: GitHub Issues

## 8. 変更履歴

| 日付         | バージョン | 変更内容        | 変更者    |
| ---------- | ----- | ----------- | ------ |
| 2025-08-26 | 1.0.0 | 初版（MVP要件定義） | System |

## 9. 関連文書

* **[SPECIFICATIONS.md](./SPECIFICATIONS.md)**: 技術仕様（UI構成、状態遷移、データ構造、テスト戦略）
* **[README.md](./README.md)**: セットアップ・学習ポイント・拡張ガイド
* **[PROJECT\_INITIALIZATION\_GUIDE.md](./PROJECT_INITIALIZATION_GUIDE.md)**: 初期化・ビルド・デプロイ手順

## 10. 承認

このドキュメントは、数当てゲームのビジネス要件定義書として承認されました。
*このドキュメントは、プロジェクトの進行に応じて更新されます。*

---

### 付録：実装ガイド（要点のみ）

* **技術選定（例）**

  * 純 JS（最小依存）／または Next.js 15（App Router）
  * スタイル：Tailwind（任意）
  * 状態：単純な React state で十分（`useState`, `useEffect`）
* **データ構造（例）**

  ```ts
  type GameState = {
    target: number;        // 乱数
    upper: number;         // 上限（難易度依存）
    guesses: number[];     // 入力履歴
    attemptsLeft: number;  // 残り試行
    timeLeft: number;      // 残り時間
    status: 'idle'|'playing'|'won'|'lost';
    settings: { difficulty: 'easy'|'normal'|'hard'; sound: boolean; };
    bestRecord?: { difficulty: string; timeMs: number; attempts: number; };
  };
  ```
* **テスト観点（例）**

  * 乱数範囲生成、判定ロジック、スコア計算、ヒント境界
* **PWA 要点**

  * `manifest.json` と Service Worker（静的アセットのキャッシュ）
  * オフライン時：直近のビルドで動作
