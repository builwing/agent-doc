#!/usr/bin/env bash
# CLAUDE.md è‡ªå‹•ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ - APIæ•´åˆæ€§é‡è¦–ç‰ˆ
set -euo pipefail

echo "ğŸ¤– CLAUDE.md ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ï¼ˆAPIæ•´åˆæ€§å¼·åŒ–ç‰ˆï¼‰..."

# è¨­å®šèª­ã¿è¾¼ã¿
PROJECT_NAME=$(basename "$PWD")
TIMESTAMP=$(date +%Y-%m-%d)

# å®Ÿéš›ã«å­˜åœ¨ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œå‡º
detect_agents() {
    if [ -d ".claude/agents" ]; then
        find .claude/agents -maxdepth 1 -type f -name "*.md" -exec basename {} .md \; 2>/dev/null || true
    fi
}

detect_requirements() {
    if [ -f "REQUIREMENTS.md" ]; then
        echo "true"
    else
        echo "false"
    fi
}

detect_api_spec_system() {
    if [ -d "api-spec-system" ]; then
        echo "true"
    else
        echo "false"
    fi
}

detect_mcp_tools() {
    if command -v claude &> /dev/null; then
        if claude mcp list 2>/dev/null | grep -q "context7"; then
            echo "true"
        else
            echo "false"
        fi
    else
        echo "false"
    fi
}

# è¦ä»¶å®šç¾©æ›¸ã‹ã‚‰ä¸»è¦ãªç›®çš„ã‚’æŠ½å‡º
extract_project_purpose() {
    if [ -f "REQUIREMENTS.md" ]; then
        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰æŠ½å‡ºï¼ˆæœ€åˆã®æ®µè½ï¼‰
        awk '/## .*ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦/,/^## [^#]/' REQUIREMENTS.md | \
        grep -v '^##' | \
        grep -v '^$' | \
        head -5 | \
        sed 's/^/  /' || echo "  ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã‚’æŠ½å‡ºã§ãã¾ã›ã‚“ã§ã—ãŸ"
    else
        echo "  è¦ä»¶å®šç¾©æ›¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
    fi
}

# Agentãƒªã‚¹ãƒˆã®å–å¾—
AGENTS_RAW=$(detect_agents)
AGENTS=()
if [ -n "$AGENTS_RAW" ]; then
    while IFS= read -r agent; do
        AGENTS+=("$agent")
    done <<< "$AGENTS_RAW"
fi
HAS_REQUIREMENTS=$(detect_requirements)
HAS_API_SPEC=$(detect_api_spec_system)
HAS_CONTEXT7=$(detect_mcp_tools)

# CLAUDE.md ç”Ÿæˆ
cat > CLAUDE.md << 'EOF'
# CLAUDE.md - APIæ•´åˆæ€§ä¿è¨¼ã‚·ã‚¹ãƒ†ãƒ è¨­å®šæ›¸

## ğŸ‡¯ğŸ‡µ æœ€å„ªå…ˆäº‹é … - æ—¥æœ¬èªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å¾¹åº•

**ã™ã¹ã¦ã®å›ç­”ã€ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆã€ã‚³ãƒ¼ãƒ‰å†…ã‚³ãƒ¡ãƒ³ãƒˆã¯å¿…ãšæ—¥æœ¬èªã§è¡Œã£ã¦ãã ã•ã„ã€‚**

---

## ğŸš¨ æœ€é‡è¦æŒ‡ç¤º - APIæ•´åˆæ€§ã®çµ¶å¯¾éµå®ˆ

**ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æœ€é‡è¦ãƒŸãƒƒã‚·ãƒ§ãƒ³:**
1. **ã™ã¹ã¦ã®å¯¾è©±ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ã‚³ãƒ¡ãƒ³ãƒˆã¯æ—¥æœ¬èªã§è¨˜è¿°ã™ã‚‹**
2. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆGo-Zeroï¼‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆNext.js/Expoï¼‰é–“ã®APIä»•æ§˜ã®å®Œå…¨ä¸€è‡´ã‚’ä¿è¨¼ã™ã‚‹**
3. **ã™ã¹ã¦ã®SubAgentã¯APIä»•æ§˜æ›¸ã‚’å”¯ä¸€ã®çœŸå®Ÿï¼ˆSingle Source of Truthï¼‰ã¨ã—ã¦æ‰±ã†**
4. **APIä»•æ§˜ã®å¤‰æ›´ã¯å¿…ãš `api-spec-system/specs/` ã‹ã‚‰é–‹å§‹ã—ã€è‡ªå‹•ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹**
5. **æ‰‹å‹•ã§ã®APIå®Ÿè£…ã‚„å‹å®šç¾©ã®ä½œæˆã¯å³ç¦**

---

## ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›®çš„

EOF

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›®çš„ã‚’è¦ä»¶å®šç¾©æ›¸ã‹ã‚‰æŠ½å‡º
echo "### è¦ä»¶å®šç¾©æ›¸ã‚ˆã‚ŠæŠ½å‡º:" >> CLAUDE.md
extract_project_purpose >> CLAUDE.md

cat >> CLAUDE.md << EOF

### ã‚·ã‚¹ãƒ†ãƒ ã®æ ¸å¿ƒä¾¡å€¤:
- **APIä»•æ§˜é§†å‹•é–‹ç™º**: ã™ã¹ã¦ã®é–‹ç™ºã¯APIä»•æ§˜æ›¸ã‹ã‚‰é–‹å§‹
- **å‹å®‰å…¨æ€§ã®ä¿è¨¼**: TypeScriptã¨Goã®å‹å®šç¾©ã‚’è‡ªå‹•ç”Ÿæˆã§åŒæœŸ
- **é½Ÿé½¬ã®å®Œå…¨æ’é™¤**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»ãƒ¢ãƒã‚¤ãƒ«é–“ã®ä¸æ•´åˆã‚’é˜²æ­¢
- **è‡ªå‹•æ¤œè¨¼**: APIä»•æ§˜æº–æ‹ ã‚’è‡ªå‹•çš„ã«ãƒã‚§ãƒƒã‚¯

---

## ğŸ›¡ï¸ APIæ•´åˆæ€§ä¿è¨¼ãƒ«ãƒ¼ãƒ«ï¼ˆå…¨SubAgentå¿…é ˆéµå®ˆï¼‰

### âš ï¸ çµ¶å¯¾ç¦æ­¢äº‹é …
1. âŒ **generated/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ç›´æ¥ç·¨é›†**
2. âŒ **APIä»•æ§˜æ›¸ã‚’çµŒç”±ã—ãªã„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¿½åŠ **
3. âŒ **æ‰‹å‹•ã§ã®å‹å®šç¾©ã‚„APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä½œæˆ**
4. âŒ **APIä»•æ§˜ã¨ç•°ãªã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã®å®Ÿè£…**
5. âŒ **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–ã•ã‚Œã¦ã„ãªã„APIã®ä½¿ç”¨**

### âœ… å¿…é ˆå®Ÿæ–½äº‹é …
1. âœ… **APIå¤‰æ›´ã¯å¿…ãš specs/*.yaml ã‚’ç·¨é›†**
2. âœ… **make generate ã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆå¾Œã«å®Ÿè£…**
3. âœ… **make validate ã§ä»•æ§˜æ¤œè¨¼ã‚’å®Ÿæ–½**
4. âœ… **make compliance ã§æº–æ‹ æ€§ãƒã‚§ãƒƒã‚¯**
5. âœ… **Context7 MCPã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æœ€æ–°ä»•æ§˜ã‚’ç¢ºèª**

---

## ğŸ¤– SubAgent å½¹å‰²åˆ†æ‹…ã¨è²¬ä»»

EOF

cat >> CLAUDE.md << EOF
ã‚ãªãŸã¯ **${PROJECT_NAME} ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®APIæ•´åˆæ€§ç®¡ç†è€…** ã¨ã—ã¦ã€ä»¥ä¸‹ã®å½¹å‰²ã‚’æŒã¡ã¾ã™ï¼š

### ğŸ“‹ ç®¡ç†å¯¾è±¡SubAgentä¸€è¦§ã¨è²¬ä»»ç¯„å›²

| Agent | APIé–¢é€£ã®è²¬ä»» | éµå®ˆäº‹é … |
|-------|--------------|---------|
| **api** | APIä»•æ§˜æ›¸ã®ç®¡ç†ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£… | specs/*.yamlã‚’å¿…ãšæ›´æ–°ã€generated/backend/ã‚’ä½¿ç”¨ |
| **next** | Webãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£… | generated/frontend/ã®å‹å®šç¾©ã¨APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ç”¨ |
| **expo** | ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªå®Ÿè£… | generated/mobile/ã®APIã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ |
| **logic** | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯è¨­è¨ˆ | APIä»•æ§˜ã«æº–æ‹ ã—ãŸãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£… |
| **qa** | APIãƒ†ã‚¹ãƒˆã€æ•´åˆæ€§æ¤œè¨¼ | APIä»•æ§˜æ›¸ã«åŸºã¥ããƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ |
| **security** | APIèªè¨¼ãƒ»èªå¯ | OpenAPI Security Schemesã«æº–æ‹  |
| **docs** | APIä»•æ§˜æ›¸ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ– | OpenAPIä»•æ§˜ã‹ã‚‰è‡ªå‹•ç”Ÿæˆ |

EOF

# å‹•çš„ã«Agentä¸€è¦§ã‚’è¿½åŠ 
if [ ${#AGENTS[@]} -gt 0 ]; then
    echo "" >> CLAUDE.md
    echo "### æ¤œå‡ºã•ã‚ŒãŸSubAgentè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«:" >> CLAUDE.md
    echo "| Agent | è¨­å®šãƒ‘ã‚¹ |" >> CLAUDE.md
    echo "|-------|----------|" >> CLAUDE.md
    
    for agent in "${AGENTS[@]}"; do
        echo "| $agent | \`.claude/agents/$agent.md\` |" >> CLAUDE.md
    done
fi

cat >> CLAUDE.md << 'EOF'

---

## ğŸ”„ APIé–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆå³æ ¼éµå®ˆï¼‰

### 1ï¸âƒ£ æ–°è¦APIè¿½åŠ æ™‚ã®ãƒ•ãƒ­ãƒ¼

```bash
# STEP 1: APIä»•æ§˜æ›¸ã‚’ç·¨é›†
vi api-spec-system/specs/core/api-spec.yaml
# ã¾ãŸã¯
vi api-spec-system/specs/services/{service-name}.yaml

# STEP 2: ä»•æ§˜ã‚’æ¤œè¨¼
cd api-spec-system
make validate

# STEP 3: ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆ
make generate

# STEP 4: ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª
ls -la generated/backend/   # Go-Zero APIã‚³ãƒ¼ãƒ‰
ls -la generated/frontend/  # Next.js å‹å®šç¾©ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
ls -la generated/mobile/    # Expo APIã‚µãƒ¼ãƒ“ã‚¹

# STEP 5: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ã¿å®Ÿè£…
# generated/ã®ã‚³ãƒ¼ãƒ‰ã¯ç·¨é›†ã›ãšã€ãƒ­ã‚¸ãƒƒã‚¯å±¤ã§å®Ÿè£…

# STEP 6: æº–æ‹ æ€§ãƒã‚§ãƒƒã‚¯
make compliance
```

### 2ï¸âƒ£ APIå¤‰æ›´æ™‚ã®ãƒ•ãƒ­ãƒ¼

```markdown
1. **å¤‰æ›´å‰ãƒã‚§ãƒƒã‚¯**
   â–¡ ç¾åœ¨ã®APIä»•æ§˜æ›¸ã‚’ç¢ºèª
   â–¡ å½±éŸ¿ã‚’å—ã‘ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç‰¹å®š
   â–¡ å¾Œæ–¹äº’æ›æ€§ã‚’æ¤œè¨

2. **ä»•æ§˜å¤‰æ›´**
   â–¡ specs/*.yaml ã‚’æ›´æ–°
   â–¡ ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æˆ¦ç•¥ã‚’é©ç”¨
   â–¡ Breaking Changeã®å ´åˆã¯æ˜è¨˜

3. **å†ç”Ÿæˆã¨æ¤œè¨¼**
   â–¡ make clean && make generate
   â–¡ make validate
   â–¡ make test

4. **å…¨ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ›´æ–°**
   â–¡ backend: ç”Ÿæˆã•ã‚ŒãŸãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ç¢ºèª
   â–¡ frontend: å‹å®šç¾©ã¨APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç¢ºèª
   â–¡ mobile: APIã‚µãƒ¼ãƒ“ã‚¹ã‚’ç¢ºèª

5. **ãƒ†ã‚¹ãƒˆå®Ÿæ–½**
   â–¡ å˜ä½“ãƒ†ã‚¹ãƒˆæ›´æ–°
   â–¡ çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½
   â–¡ E2Eãƒ†ã‚¹ãƒˆç¢ºèª
```

---

## ğŸ“Š APIæ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### å„SubAgentãŒå®Ÿè£…å‰ã«ç¢ºèªã™ã‚‹ã“ã¨:

```markdown
## API Agent
â–¡ OpenAPI 3.1ä»•æ§˜ã«æº–æ‹ ã—ã¦ã„ã‚‹ã‹
â–¡ ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«operationIdãŒã‚ã‚‹ã‹
â–¡ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ã‚­ãƒ¼ãƒãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹
â–¡ ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæ¨™æº–åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹
â–¡ x-go-zeroæ‹¡å¼µãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
â–¡ APIä»•æ§˜æ›¸ã®descriptionã¯æ—¥æœ¬èªã§è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã‹

## Next.js Agent
â–¡ generated/frontend/types/ ã®å‹å®šç¾©ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹
â–¡ generated/frontend/api/ ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹
â–¡ æ‰‹å‹•ã§fetch()ã‚’ä½¿ã£ã¦ã„ãªã„ã‹
â–¡ å‹å®‰å…¨æ€§ãŒä¿è¨¼ã•ã‚Œã¦ã„ã‚‹ã‹

## Expo Agent  
â–¡ generated/mobile/services/ ã®APIã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹
â–¡ ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œãŒä»•æ§˜é€šã‚Šã‹
â–¡ èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ç®¡ç†ãŒé©åˆ‡ã‹
â–¡ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒçµ±ä¸€ã•ã‚Œã¦ã„ã‚‹ã‹

## QA Agent
â–¡ APIä»•æ§˜æ›¸ã«åŸºã¥ããƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‹
â–¡ Contract Testingã‚’å®Ÿæ–½ã—ã¦ã„ã‚‹ã‹
â–¡ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹æ¤œè¨¼ã‚’ã—ã¦ã„ã‚‹ã‹
â–¡ ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã‚’ç¶²ç¾…ã—ã¦ã„ã‚‹ã‹
```

---

## ğŸš¨ ã‚¨ãƒ©ãƒ¼é˜²æ­¢ã®ãŸã‚ã®Context7æ´»ç”¨

EOF

if [ "$HAS_CONTEXT7" = "true" ]; then
    cat >> CLAUDE.md << 'EOF'
### Context7 MCPã‚µãƒ¼ãƒãƒ¼ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ âœ…

**å¿…é ˆå®Ÿæ–½äº‹é …:**
1. Next.js 15ã®æœ€æ–°ä»•æ§˜ç¢ºèª: `mcp__context7__get-library-docs`
2. Expo SDKæœ€æ–°ç‰ˆã®ç¢ºèª: `mcp__context7__resolve-library-id`
3. Go-Zeroã®æœ€æ–°ãƒ‘ã‚¿ãƒ¼ãƒ³ç¢ºèª
4. å®Ÿè£…å‰ã«å¿…ãšæœ€æ–°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§

```typescript
// ä¾‹: Next.js 15ã®æœ€æ–°æ©Ÿèƒ½ã‚’ç¢ºèª
await mcp__context7__get-library-docs({
  context7CompatibleLibraryID: '/vercel/next.js',
  topic: 'app-router'
});
```
EOF
else
    cat >> CLAUDE.md << 'EOF'
### âš ï¸ Context7 MCPã‚µãƒ¼ãƒãƒ¼ãŒæœªæ¤œå‡º

**æ¨å¥¨:** `./scripts/generate_agents_from_requirements.sh` ã‚’å®Ÿè¡Œã—ã¦Context7ã‚’è‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æœ€æ–°ä»•æ§˜ã‚’è‡ªå‹•å‚ç…§ã—ã€å¤ã„APIã®ä½¿ç”¨ã‚’é˜²ã’ã¾ã™ã€‚
EOF
fi

cat >> CLAUDE.md << 'EOF'

---

## ğŸ¯ æˆåŠŸæŒ‡æ¨™ã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹

### APIæ•´åˆæ€§æŒ‡æ¨™:
- **ä»•æ§˜æº–æ‹ ç‡**: 100%ï¼ˆgenerated/ã®ã¿ä½¿ç”¨ï¼‰
- **å‹å®‰å…¨ã‚«ãƒãƒ¬ãƒƒã‚¸**: 100%ï¼ˆã™ã¹ã¦ã®APIã‚³ãƒ¼ãƒ«ï¼‰
- **è‡ªå‹•ç”Ÿæˆç‡**: 95%ä»¥ä¸Šï¼ˆæ‰‹å‹•ã‚³ãƒ¼ãƒ‰æœ€å°åŒ–ï¼‰
- **APIä»•æ§˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–ç‡**: 100%
- **æ—¥æœ¬èªåŒ–ç‡**: 100%ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€ã‚³ãƒ¡ãƒ³ãƒˆã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰

### å“è³ªæŒ‡æ¨™:
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: 80%ä»¥ä¸Š
- **E2Eãƒ†ã‚¹ãƒˆæˆåŠŸç‡**: 95%ä»¥ä¸Š
- **APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ **: 200msä»¥ä¸‹
- **ã‚¨ãƒ©ãƒ¼ç‡**: 1%æœªæº€
- **æ—¥æœ¬èªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³éµå®ˆç‡**: 100%

---

## ğŸ’¡ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•:

| å•é¡Œ | åŸå›  | è§£æ±ºæ–¹æ³• |
|------|------|----------|
| å‹ã‚¨ãƒ©ãƒ¼ | æ‰‹å‹•ã§å‹å®šç¾©ã‚’ä½œæˆ | generated/ã®å‹å®šç¾©ã‚’ä½¿ç”¨ |
| APIä¸æ•´åˆ | ä»•æ§˜æ›¸ã‚’æ›´æ–°ã›ãšã«å®Ÿè£… | specs/*.yamlã‹ã‚‰å†ç”Ÿæˆ |
| CORS ã‚¨ãƒ©ãƒ¼ | APIä»•æ§˜ã«CORSè¨­å®šãªã— | OpenAPIã«CORSè¨­å®šè¿½åŠ  |
| èªè¨¼ã‚¨ãƒ©ãƒ¼ | Security Schemesæœªå®šç¾© | OpenAPIã«Securityè¿½åŠ  |
| ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¸ä¸€è‡´ | æ‰‹å‹•å®Ÿè£…ã¨ã®é½Ÿé½¬ | make complianceã§æ¤œè¨¼ |

---

## ğŸ“š å¿…é ˆå‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### APIä»•æ§˜ã‚·ã‚¹ãƒ†ãƒ :
- `api-spec-system/README.md` - APIä»•æ§˜ã‚·ã‚¹ãƒ†ãƒ ã‚¬ã‚¤ãƒ‰
- `api-spec-system/specs/` - APIä»•æ§˜æ›¸ï¼ˆçœŸå®Ÿã®æºï¼‰
- `api-spec-system/generated/` - è‡ªå‹•ç”Ÿæˆã‚³ãƒ¼ãƒ‰ï¼ˆç·¨é›†ç¦æ­¢ï¼‰

### è¦ä»¶å®šç¾©:
EOF

if [ "$HAS_REQUIREMENTS" = "true" ]; then
    echo "- \`REQUIREMENTS.md\` - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦ä»¶å®šç¾©æ›¸ âœ…" >> CLAUDE.md
else
    echo "- \`REQUIREMENTS.md\` - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦ä»¶å®šç¾©æ›¸ âš ï¸ æœªä½œæˆ" >> CLAUDE.md
fi

if [ ${#AGENTS[@]} -gt 0 ]; then
    echo "- \`docs/agents/*/REQUIREMENTS.md\` - å„Agentè¦ä»¶å®šç¾©" >> CLAUDE.md
fi

cat >> CLAUDE.md << EOF

---

## ğŸ”„ æ›´æ–°å±¥æ­´

- ${TIMESTAMP}: APIæ•´åˆæ€§å¼·åŒ–ç‰ˆã¨ã—ã¦è‡ªå‹•ç”Ÿæˆ
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ: ${PROJECT_NAME}
- æ¤œå‡ºã•ã‚ŒãŸAgentæ•°: ${#AGENTS[@]}
- APIä»•æ§˜ã‚·ã‚¹ãƒ†ãƒ : ${HAS_API_SPEC}
- Context7çµ±åˆ: ${HAS_CONTEXT7}
- è¦ä»¶å®šç¾©æ›¸: ${HAS_REQUIREMENTS}

---

## âš ï¸ æœ€çµ‚ç¢ºèªäº‹é …

**ã™ã¹ã¦ã®SubAgentã¯ä»¥ä¸‹ã‚’å³å®ˆã—ã¦ãã ã•ã„:**

1. **æ—¥æœ¬èªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³** - ã™ã¹ã¦ã®å›ç­”ãƒ»èª¬æ˜ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯æ—¥æœ¬èªã§è¨˜è¿°
2. **APIä»•æ§˜æ›¸ãŒã™ã¹ã¦ã®å§‹ã¾ã‚Š** - specs/*.yamlã‚’æ›´æ–°ã—ã¦ã‹ã‚‰å®Ÿè£…
3. **è‡ªå‹•ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã®ä½¿ç”¨** - generated/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’æ´»ç”¨
4. **æ‰‹å‹•å®Ÿè£…ã®æœ€å°åŒ–** - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤ã®ã¿æ‰‹å‹•å®Ÿè£…
5. **å‹å®‰å…¨æ€§ã®ä¿è¨¼** - TypeScriptã¨Goã®å‹ã‚’è‡ªå‹•åŒæœŸ
6. **ç¶™ç¶šçš„æ¤œè¨¼** - make validate/complianceã‚’å®šæœŸå®Ÿè¡Œ
7. **ã‚³ãƒ¼ãƒ‰å†…ã‚³ãƒ¡ãƒ³ãƒˆã®æ—¥æœ¬èªåŒ–** - å¤‰æ•°åã¯è‹±èªã€ã‚³ãƒ¡ãƒ³ãƒˆã¯æ—¥æœ¬èª

**ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯APIæ•´åˆæ€§ä¿è¨¼ã‚·ã‚¹ãƒ†ãƒ ã®ä¸­æ ¸è¨­å®šã§ã™ã€‚**
**ã™ã¹ã¦ã®é–‹ç™ºä½œæ¥­ã¯ã“ã®è¨­å®šã«å¾“ã£ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚**

---

### ğŸš€ é–‹ç™ºé–‹å§‹ã‚³ãƒãƒ³ãƒ‰

\`\`\`bash
# APIä»•æ§˜ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã¨æ¤œè¨¼
cd api-spec-system
make setup      # åˆå›ã®ã¿
make validate   # ä»•æ§˜æ¤œè¨¼
make generate   # ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
make compliance # æº–æ‹ æ€§ãƒã‚§ãƒƒã‚¯
\`\`\`

**APIä»•æ§˜ã®æ•´åˆæ€§ã“ããŒã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æˆåŠŸã®éµã§ã™ã€‚**
EOF

echo "âœ… CLAUDE.md ã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼ˆAPIæ•´åˆæ€§å¼·åŒ–ç‰ˆï¼‰ï¼"
echo ""
echo "ğŸ“Š ç”Ÿæˆå†…å®¹:"
echo "  - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå: ${PROJECT_NAME}"
echo "  - æ¤œå‡ºã•ã‚ŒãŸAgent: ${AGENTS[@]:-ãªã—}"
echo "  - APIä»•æ§˜ã‚·ã‚¹ãƒ†ãƒ : ${HAS_API_SPEC}"
echo "  - Context7çµ±åˆ: ${HAS_CONTEXT7}"
echo "  - è¦ä»¶å®šç¾©æ›¸: ${HAS_REQUIREMENTS}"
echo ""
echo "ğŸ¯ ã“ã®CLAUDE.mdã®ç‰¹å¾´:"
echo "  â€¢ APIä»•æ§˜é§†å‹•é–‹ç™ºã®å¾¹åº•"
echo "  â€¢ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰/ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰/ãƒ¢ãƒã‚¤ãƒ«é–“ã®æ•´åˆæ€§ä¿è¨¼"
echo "  â€¢ è‡ªå‹•ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹å‹å®‰å…¨æ€§"
echo "  â€¢ æ‰‹å‹•å®Ÿè£…ã®æœ€å°åŒ–"
echo "  â€¢ Context7ã«ã‚ˆã‚‹æœ€æ–°ä»•æ§˜ã®è‡ªå‹•å‚ç…§"
echo ""
echo "æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:"
echo "  1. CLAUDE.md ã‚’ç¢ºèª"
echo "  2. APIä»•æ§˜æ›¸ï¼ˆapi-spec-system/specs/ï¼‰ã‚’å®šç¾©"
echo "  3. make generate ã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ"
echo "  4. å„SubAgentãŒç”Ÿæˆã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦å®Ÿè£…"